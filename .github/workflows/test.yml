# ğŸ“¦ TÃªn cá»§a workflow, sáº½ hiá»ƒn thá»‹ trong tab Actions trÃªn GitHub
name: Deploy Angular to GitHub Pages

# ğŸš€ CÃ¡c trigger Ä‘á»ƒ cháº¡y workflow
on:
  push:
    branches: ["demo-add-picture"]  # Cháº¡y khi cÃ³ code Ä‘Æ°á»£c push lÃªn nhÃ¡nh nÃ y
  workflow_dispatch:                # Cho phÃ©p cháº¡y workflow thá»§ cÃ´ng tá»« GitHub UI

# ğŸ” Quyá»n truy cáº­p cáº§n thiáº¿t Ä‘á»ƒ workflow hoáº¡t Ä‘á»™ng
permissions:
  contents: read       # Cho phÃ©p Ä‘á»c ná»™i dung repository
  pages: write         # Cho phÃ©p ghi ná»™i dung lÃªn GitHub Pages
  id-token: write      # Cáº§n cho xÃ¡c thá»±c khi deploy

# ğŸš¦ Äáº£m báº£o chá»‰ cÃ³ 1 workflow deploy Ä‘ang cháº¡y (trÃ¡nh xung Ä‘á»™t)
concurrency:
  group: "pages"               # TÃªn nhÃ³m concurrency
  cancel-in-progress: false    # KhÃ´ng há»§y workflow Ä‘ang cháº¡y náº¿u cÃ³ workflow má»›i

# ğŸ§± Job build: thá»±c hiá»‡n build á»©ng dá»¥ng Angular
jobs:
  build:
    runs-on: ubuntu-latest     # Cháº¡y trÃªn mÃ´i trÆ°á»ng Ubuntu

    steps:
      # ğŸ”„ BÆ°á»›c 1: Láº¥y code tá»« repository
      - name: Checkout
        uses: actions/checkout@v4

      # ğŸ”§ BÆ°á»›c 2: CÃ i Ä‘áº·t Node.js (phiÃªn báº£n 20)
      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      # ğŸ“¦ BÆ°á»›c 3: CÃ i Ä‘áº·t cÃ¡c package tá»« package-lock.json
      - name: Install Dependencies
        run: npm ci

      # ğŸ—ï¸ BÆ°á»›c 4: Build Angular vá»›i cáº¥u hÃ¬nh production
      - name: Build Angular
        run: npm run build -- --configuration=production --base-href=/Bommer69/
        # âš ï¸ base-href ráº¥t quan trá»ng cho GitHub Pages

      # ğŸ” BÆ°á»›c 5: Kiá»ƒm tra thÆ° má»¥c Ä‘áº§u ra sau khi build
      - name: Verify Output
        run: |
          echo "Build output:"
          ls -R dist/  # Kiá»ƒm tra xem output build ra Ä‘Ãºng chÆ°a

      # â˜ï¸ BÆ°á»›c 6: Táº£i artifact (thÆ° má»¥c build) Ä‘á»ƒ chuáº©n bá»‹ deploy
      - name: Upload Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist/my-angular-app  # âš ï¸ Äá»•i 'my-angular-app' thÃ nh tÃªn thÆ° má»¥c thá»±c táº¿ trong dist/
  

  # ğŸš€ Job deploy: triá»ƒn khai lÃªn GitHub Pages
  deploy:
    environment:
      name: github-pages                     # TÃªn mÃ´i trÆ°á»ng
      url: ${{ steps.deployment.outputs.page_url }}  # Láº¥y URL sau khi deploy xong

    runs-on: ubuntu-latest
    needs: build                             # Job nÃ y cháº¡y sau khi build thÃ nh cÃ´ng

    steps:
      # ğŸš€ Deploy artifact lÃªn GitHub Pages
      - name: Deploy
        id: deployment
        uses: actions/deploy-pages@v4        # DÃ¹ng action chÃ­nh thá»©c cá»§a GitHub Ä‘á»ƒ deploy
